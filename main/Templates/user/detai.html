{% extends 'user/base.html' %}
{% load static %}
{% block detai %}
    {% include 'admin/message.html' %}

    <main>
        <div class="wrapper">
            <div class="containerr">
                
                <div class="story-header">
                    <img src="{{comic.ImageURL}}" alt="Ảnh truyện"> 
                    <div class="story-info">
                        <h3> {{ comic.name }}  </h3>
                        <p><strong>Tác giả:</strong> {{ comic.author }}</p>

                        <p><strong>Thể loại:</strong>
                            {% for category in comic.categories.all %}
                                {{ category.name }}
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                        

                        {% comment %} <p><strong>Lượt thích:</strong> <span id="comic_likes">{{ comic.likes }}</span></p> {% endcomment %}
                        <p><strong>Lượt theo dõi:</strong> 0 </p>
                        <p><strong>Lượt xem:</strong> {{ comic.view }} </p>

                            <div class="buttons">
                                <button class="action-btn read-from-beginning">Đọc Ngay</button>
                                <button class="action-btn read-immediately">Đọc Từ Đầu</button>

                                <script>
                                    
                                    // Đọc Ngay
                                    $(document).ready(function() {
                                        $('.read-immediately').click(function() {
                                            var lastChapterUrl = $('.chapter-list__item:last-child a').attr('href');
                                            window.location.href = lastChapterUrl;
                                        });
                                    });

                                    // Đọc Từ Đầu                                                  
                                    $(document).ready(function() {
                                        $('.read-from-beginning').click(function() {
                                            var firstChapterUrl = $('.chapter-list__item:first-child a').attr('href');
                                            window.location.href = firstChapterUrl;
                                        });
                                    });
                                </script>




                                {% if user.is_authenticated %}
                                    {% if follow.exists %}
                                        <form action="{% url 'unfollowcomic' comic_id=comic.id %}" method="post">
                                            {% csrf_token %}
                                            <button class="primary-btn btn-sm border-0" type="submit">Bỏ theo dõi</button>
                                        </form>
                                    {% else %}
                                        <form action="{% url 'followcomic' comic_id=comic.id %}" method="post">
                                            {% csrf_token %}
                                            <button class="primary-btn btn-sm border-0" type="submit">Theo dõi</button>
                                        </form>
                                    {% endif %}
                                {% else %}
                                    <button class="primary-btn btn-sm border-0" data-bs-toggle="modal" data-bs-target="#exampleModalFollow">Theo dõi</button>

                                    <div class="modal fade" id="exampleModalFollow" tabindex="-1"
                                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="fs-5">Popover in a modal</h5>
                                                    <button type="button" class="close" data-bs-dismiss="modal"
                                                            aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    Bạn cần đăng nhập để thực hiện chức năng theo dõi. Bạn có muốn
                                                    đăng nhập không?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Hủy
                                                    </button>
                                                    <a href="{% url 'login' %}" class="btn btn-primary">Đồng ý</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                    </div>
                </div>

                <h5>Nội dung truyện: {{ comic.name }} </h5>
                <div class="story-introduction">
                    <p>
                        {{ comic.Describe }}
                    </p>
                </div>
                
                <div class="chapter-list">
                    <h4 class="chapter-list__title">Danh sách chương</h4>
                    <ul class="chapter-list__items">
                        {% for chap in chapters %}
                        <li class="chapter-list__item">
                            <a href="{% url 'readcomic' chapter_slug=comic.slug %}?chap={{ chap.id }}">{{ chap.name }}</a>
                        </li>
                        {% endfor %}
                        
                    </ul>
                </div>

            </div>
        </div>
    </main>


    {% endblock detai %}
