{% extends 'user/base.html' %}
{% load static %}
{% block information %}


<div class="profile-container">
    <div class="left-sidebar">
        <img src="{% static 'user/img/avatar.jpg' %}" alt="Ảnh cá nhân" class="profile-picture">
        <ul class="sidebar-menu">
            <li><a href="#general-info">Thông tin chung</a></li>
            <li><a href="#change-password">Đổi mật khẩu</a></li>
            
        </ul>
    </div>

    <div class="right-content">
        <!-- Khung thông tin chi tiết -->
        <div id="general-info" class="info-section">
            <!-- Thông tin chung -->
            <h2>Thông tin chung</h2>
            <div class="info-item">
                <strong>Họ và tên:</strong>
                <span class="name">Tên của bạn</span>
            </div>
            <div class="info-item">
                <strong>Email:</strong>
                <span class="email">example@gmail.com</span>
            </div>
        </div>
        

        

        <div id="change-password" class="info-section">
            
            <h2>Đổi mật khẩu</h2>
            <div class="info-item">
                <label for="current-password">Mật khẩu hiện tại:</label>
                <input type="password" id="current-password" name="current-password">
            </div>
            <div class="info-item">
                <label for="new-password">Mật khẩu mới:</label>
                <input type="password" id="new-password" name="new-password">
            </div>
            <div class="info-item">
                <label for="confirm-password">Nhập lại mật khẩu mới:</label>
                <input type="password" id="confirm-password" name="confirm-password">
            </div>
            <div class="info-item">
                <button id="change-password-btn">Đổi mật khẩu</button>
            </div>
        </div>

        <script>
            // Lấy CSRF token từ cookies
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Kiểm tra nếu tìm thấy CSRF token
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

$(document).ready(function() {
    $('#change-password-btn').click(function() {
        var currentPassword = $('#current-password').val();
        var newPassword = $('#new-password').val();
        var confirmPassword = $('#confirm-password').val();

        // Lấy CSRF token
        var csrftoken = getCookie('csrftoken');

        // Perform validation checks
        if (currentPassword === '' || newPassword === '' || confirmPassword === '') {
            alert('Vui lòng điền đầy đủ thông tin.');
            return;
        }

        if (newPassword !== confirmPassword) {
            alert('Mật khẩu mới và xác nhận mật khẩu không khớp.');
            return;
        }
        $.ajax({
            url: '/changepassword/',
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken
            },
            data: {
                current_password: currentPassword,
                new_password: newPassword,
                confirm_password: confirmPassword
            },
            success: function(response) {
                alert('Mật khẩu đã được thay đổi thành công.');
            },
            error: function(xhr, status, error) {
                alert('Đã xảy ra lỗi: ' + error);
            }
        });
    });
});

            
        </script>
        
        
    </div>
</div>


<script>
    
document.addEventListener("DOMContentLoaded", function() {
    const menuItems = document.querySelectorAll('.sidebar-menu a');

    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);

            
            document.querySelectorAll('.info-section').forEach(section => {
                section.classList.remove('active');
            });

            // Hiển thị phần thông tin được chọn
            targetSection.classList.add('active');

            // Loại bỏ class active từ tất cả các mục khác
            menuItems.forEach(item => {
                item.classList.remove('active');
            });

            // Thêm class active vào mục được nhấp vào
            this.classList.add('active');
        });
    });
});

</script>




{% endblock information %}